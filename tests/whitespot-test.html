<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>LCDãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’</title>
<link rel="stylesheet" href="common-layout.css">
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

body {
  font-family: sans-serif;
  background-color: white !important; /* ì´ˆê¸° ë°°ê²½ìƒ‰ì€ ë‹¤ì‹œ í°ìƒ‰ìœ¼ë¡œ */
  cursor: default;
}

/* ì „ì²´í™”ë©´ í™œì„± ëª¨ë“œì¼ ë•Œ HTMLê³¼ BODYì— ëŒ€í•œ ìŠ¤íƒ€ì¼ */
html.fullscreen-active-mode {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  margin: 0 !important;
  padding: 0 !important;
  overflow: hidden;
  z-index: 9999;
}

/* ì¶”ê°€: ì „ì²´í™”ë©´ ëª¨ë“œì¼ ë•Œ bodyì˜ ë°°ê²½ìƒ‰ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šë„ë¡ */
html.fullscreen-active-mode body {
   background-color: initial !important; /* ë˜ëŠ” white !important; */
}


html.fullscreen-active-mode h1,
html.fullscreen-active-mode .nav-buttons,
html.fullscreen-active-mode .start-button,
html.fullscreen-active-mode p.instruction-text {
  display: none !important;
}

.start-button {
  display: block;
  margin: 100px auto 30px auto;
  width: 250px;
  height: auto;
  cursor: pointer;
  z-index: 5;
}

p.instruction-text {
  font-size: 18px;
  margin: 0 auto 30px auto;
  text-align: center;
  max-width: 80%;
}

.hidden {
  display: none;
}

audio {
  display: none;
}

.end-message {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  font-size: 28px;
  padding: 30px 50px;
  border-radius: 10px;
  text-align: center;
  line-height: 1.5;
  display: none;
  z-index: 99999;
}
.end-message span {
  display: block;
}
</style>
</head>
<body>

<h1><a href="../index.html" class="title-link">LCDãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ</a></h1>

<img id="start" class="start-button" src="../media/images/whitespot-button.png" alt="ã‚¹ã‚¿ãƒ¼ãƒˆ">
<p class="instruction-text">ç”»é¢ã«ä¸å…·åˆãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ğŸ”</p>

<div id="endMessage" class="end-message">
  <span>í…ŒìŠ¤íŠ¸ ë!</span>
  <span>ESCí‚¤ ëˆ„ë¥´ë©´ ì¢…ë£Œë¼.</span>
</div>

<div id="nav" class="nav-buttons">
  <button onclick="playAndNavigate('sound-previous', 'speaker-test.html')">â¬… å‰ã®ãƒ†ã‚¹ãƒˆ</button>
  <button onclick="playAndNavigate('sound-home', '../index.html')">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  <button onclick="playAndNavigate('sound-next', 'youtube-test.html')">æ¬¡ã®ãƒ†ã‚¹ãƒˆ â¡</button>
</div>

<audio id="sound-previous" src="../media/audio/previous-button-sound.mp3"></audio>
<audio id="sound-home" src="../media/audio/home-button-sound.mp3"></audio>
<audio id="sound-next" src="../media/audio/next-button-sound.mp3"></audio>

<script>
const colors = ['red', 'green', 'white', 'blue', 'black'];
let currentIndex = -1;
let testStarted = false;
const endMessageEl = document.getElementById("endMessage");
const htmlEl = document.documentElement; // html íƒœê·¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°

function startTest() {
  document.getElementById("start").classList.add("hidden");
  document.querySelector('h1').classList.add("hidden");
  document.querySelector('p.instruction-text').classList.add("hidden");
  document.getElementById("nav").classList.add("hidden");

  testStarted = true;
  currentIndex = -1; // ì´ê±¸ -1ë¡œ ìœ ì§€í•´ì„œ showNextColorì—ì„œ ì²« ë²ˆì§¸ ìƒ‰ê¹”ì´ ë‚˜ì˜¤ê²Œ í•´.

  // bodyì™€ html íƒœê·¸ì˜ ë°°ê²½ìƒ‰ì„ ëª¨ë‘ ì²« ë²ˆì§¸ ìƒ‰ìƒìœ¼ë¡œ ê°•ì œ ì„¤ì •
  document.body.style.setProperty("background-color", colors[0], "important");
  document.documentElement.style.setProperty("background-color", colors[0], "important"); // html íƒœê·¸ì—ë„ ì ìš©!

  tryFullscreen().then(success => {
    if (!success) activateSimulatedFullscreen();
    document.body.style.cursor = "none";
    // â­ ì´ ì¤„ì„ ì œê±°í–ˆì–´! ì´ì œ showNextColorëŠ” í´ë¦­ ì´ë²¤íŠ¸ë¡œë§Œ í˜¸ì¶œë¼.
    // showNextColor(); 
  });
}

function tryFullscreen() {
  return new Promise(resolve => {
    if (document.body.requestFullscreen) {
      document.body.requestFullscreen().then(() => {
        resolve(true);
      }).catch(err => {
        console.warn("ì „ì²´í™”ë©´ ì‹¤íŒ¨:", err);
        resolve(false);
      });
    } else {
      resolve(false);
    }
  });
}

function activateSimulatedFullscreen() {
  htmlEl.classList.add('fullscreen-active-mode');
}

function endTest() {
  testStarted = false;
  currentIndex = -1;
  endMessageEl.style.display = 'flex';

  if (document.fullscreenElement) {
    document.exitFullscreen().then(() => {
      restoreInitialUI();
    }).catch(() => {
      restoreInitialUI();
    });
  } else {
    restoreInitialUI();
  }
}

function restoreInitialUI() {
  htmlEl.classList.remove('fullscreen-active-mode');
  document.getElementById("start").classList.remove("hidden");
  document.querySelector('h1').classList.remove("hidden");
  document.querySelector('p.instruction-text').classList.remove("hidden");
  document.getElementById("nav").classList.remove("hidden");
  document.body.style.backgroundColor = "white"; // ì´ˆê¸° ë°°ê²½ìƒ‰ìœ¼ë¡œ ëŒë ¤ë†”
  document.body.style.cursor = "default";
  endMessageEl.style.display = 'none';
}

function showNextColor() {
  if (!testStarted) return;
  currentIndex++;
  if (currentIndex >= colors.length) {
    endTest();
  } else {
    document.body.style.setProperty("background-color", colors[currentIndex], "important");
  }
}

function playAndNavigate(soundId, nextPage) {
  const audio = document.getElementById(soundId);
  if (!audio) {
    location.href = nextPage;
    return;
  }
  audio.currentTime = 0;
  audio.play().then(() => {
    setTimeout(() => {
      location.href = nextPage;
    }, 400);
  }).catch(() => {
    location.href = nextPage;
  });
}

document.getElementById("start").addEventListener("click", startTest);
document.getElementById("start").addEventListener("touchstart", (e) => {
  e.preventDefault();
  startTest();
}, { passive: false });

document.body.addEventListener("click", showNextColor);
document.body.addEventListener("touchstart", (e) => {
  e.preventDefault();
  showNextColor();
}, { passive: false });

document.addEventListener('keydown', (event) => {
  if (event.key === 'Escape') {
    if (testStarted) {
      endTest();
    }
  }
});

document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement && testStarted) {
    endTest();
  }
});
</script>

</body>
</html>
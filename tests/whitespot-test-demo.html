<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>LCDãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’</title>
<link rel="stylesheet" href="common-layout.css">
<style>
html, body {
Â  margin: 0;
Â  padding: 0;
Â  height: 100%;
Â  width: 100%;
Â  overflow: hidden;
}

body {
Â  font-family: sans-serif;
Â  background-color: white !important; /* ì´ˆê¸° ë°°ê²½ìƒ‰ì€ ë‹¤ì‹œ í°ìƒ‰ìœ¼ë¡œ */
Â  cursor: default;
}

/* ì „ì²´í™”ë©´ í™œì„± ëª¨ë“œì¼ ë•Œ HTMLê³¼ BODYì— ëŒ€í•œ ìŠ¤íƒ€ì¼ */
html.fullscreen-active-mode {
Â  position: fixed;
Â  top: 0;
Â  left: 0;
Â  width: 100vw;
Â  height: 100vh;
Â  margin: 0 !important;
Â  padding: 0 !important;
Â  overflow: hidden;
Â  z-index: 9999;
}

/* ì¶”ê°€: ì „ì²´í™”ë©´ ëª¨ë“œì¼ ë•Œ bodyì˜ ë°°ê²½ìƒ‰ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šë„ë¡ */
html.fullscreen-active-mode body {
Â  Â background-color: initial !important; /* ë˜ëŠ” white !important; */
}


html.fullscreen-active-mode h1,
/*html.fullscreen-active-mode .nav-buttons,*/
html.fullscreen-active-mode .start-button,
html.fullscreen-active-mode p.instruction-text {
Â  display: none !important;
}

.start-button {
Â  display: block;
Â  margin: 100px auto 30px auto;
Â  width: 250px;
Â  height: auto;
Â  cursor: pointer;
Â  z-index: 5;
}

p.instruction-text {
Â  font-size: 18px;
Â  margin: 0 auto 30px auto;
Â  text-align: center;
Â  max-width: 80%;
}

.hidden {
Â  display: none;
}

audio {
Â  display: none;
}

.end-message {
Â  position: fixed;
Â  top: 50%;
Â  left: 50%;
Â  transform: translate(-50%, -50%);
Â  background: rgba(0, 0, 0, 0.8);
Â  color: white;
Â  font-size: 28px;
Â  padding: 30px 50px;
Â  border-radius: 10px;
Â  text-align: center;
Â  line-height: 1.5;
Â  display: none;
Â  z-index: 99999;
}
.end-message span {
Â  display: block;
}
</style>
</head>
<body>

<h1><a href="../index.html" class="title-link">LCDãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ</a></h1>

<img id="start" class="start-button" src="../media/images/whitespot-button.png" alt="ã‚¹ã‚¿ãƒ¼ãƒˆ">
<p class="instruction-text">ç”»é¢ã«ä¸å…·åˆãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ğŸ”</p>

<div id="endMessage" class="end-message">
Â  <span>í…ŒìŠ¤íŠ¸ ë!</span>
Â  <span>ESCí‚¤ ëˆ„ë¥´ë©´ ì¢…ë£Œë¼.</span>
</div>

<div id="nav" class="nav-buttons">
Â  <button onclick="playAndNavigate('sound-previous', 'speaker-test.html')">â¬… å‰ã®ãƒ†ã‚¹ãƒˆ</button>
Â  <button onclick="playAndNavigate('sound-home', '../index.html')">ğŸ  ãƒ›ãƒ¼ãƒ </button>
Â  <button onclick="playAndNavigate('sound-next', 'youtube-test.html')">æ¬¡ã®ãƒ†ã‚¹ãƒˆ â¡</button>
</div>

<audio id="sound-previous" src="../media/audio/previous-button-sound.mp3"></audio>
<audio id="sound-home" src="../media/audio/home-button-sound.mp3"></audio>
<audio id="sound-next" src="../media/audio/next-button-sound.mp3"></audio>

<script>
const colors = ['red', 'green', 'white', 'blue', 'black'];
let currentIndex = -1;
let testStarted = false;
const endMessageEl = document.getElementById("endMessage");
const htmlEl = document.documentElement; // html íƒœê·¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°

function startTest() {
Â  document.getElementById("start").classList.add("hidden");
Â  document.querySelector('h1').classList.add("hidden");
Â  document.querySelector('p.instruction-text').classList.add("hidden");
Â  document.getElementById("nav").classList.add("hidden");

Â  testStarted = true;
Â  currentIndex = -1; // ì´ê±¸ -1ë¡œ ìœ ì§€í•´ì„œ showNextColorì—ì„œ ì²« ë²ˆì§¸ ìƒ‰ê¹”ì´ ë‚˜ì˜¤ê²Œ í•´.

Â  // bodyì™€ html íƒœê·¸ì˜ ë°°ê²½ìƒ‰ì„ ëª¨ë‘ ì²« ë²ˆì§¸ ìƒ‰ìƒìœ¼ë¡œ ê°•ì œ ì„¤ì •
Â  document.body.style.setProperty("background-color", colors[0], "important");
Â  document.documentElement.style.setProperty("background-color", colors[0], "important"); // html íƒœê·¸ì—ë„ ì ìš©!

Â  tryFullscreen().then(success => {
Â  Â  if (!success) activateSimulatedFullscreen();
Â  Â  document.body.style.cursor = "none";
Â  Â  // â­ ì´ ì¤„ì„ ì œê±°í–ˆì–´! ì´ì œ showNextColorëŠ” í´ë¦­ ì´ë²¤íŠ¸ë¡œë§Œ í˜¸ì¶œë¼.
Â  Â  // showNextColor(); 
Â  });
}

function tryFullscreen() {
Â  return new Promise(resolve => {
Â  Â  if (document.body.requestFullscreen) {
Â  Â  Â  document.body.requestFullscreen().then(() => {
Â  Â  Â  Â  resolve(true);
Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  console.warn("ì „ì²´í™”ë©´ ì‹¤íŒ¨:", err);
Â  Â  Â  Â  resolve(false);
Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  resolve(false);
Â  Â  }
Â  });
}

function activateSimulatedFullscreen() {
Â  htmlEl.classList.add('fullscreen-active-mode');
}

function endTest() {
Â  testStarted = false;
Â  currentIndex = -1;
Â  endMessageEl.style.display = 'flex';

Â  if (document.fullscreenElement) {
Â  Â  document.exitFullscreen().then(() => {
Â  Â  Â  restoreInitialUI();
Â  Â  }).catch(() => {
Â  Â  Â  restoreInitialUI();
Â  Â  });
Â  } else {
Â  Â  restoreInitialUI();
Â  }
}

function restoreInitialUI() {
Â  htmlEl.classList.remove('fullscreen-active-mode');
Â  document.getElementById("start").classList.remove("hidden");
Â  document.querySelector('h1').classList.remove("hidden");
Â  document.querySelector('p.instruction-text').classList.remove("hidden");
Â  document.getElementById("nav").classList.remove("hidden");
Â  document.body.style.backgroundColor = "white"; // ì´ˆê¸° ë°°ê²½ìƒ‰ìœ¼ë¡œ ëŒë ¤ë†”
Â  document.body.style.cursor = "default";
Â  endMessageEl.style.display = 'none';
}

function showNextColor() {
Â  if (!testStarted) return;
Â  currentIndex++;
Â  if (currentIndex >= colors.length) {
Â  Â  endTest();
Â  } else {
Â  Â  document.body.style.setProperty("background-color", colors[currentIndex], "important");
Â  }
}

function playAndNavigate(soundId, nextPage) {
Â  const audio = document.getElementById(soundId);
Â  if (!audio) {
Â  Â  location.href = nextPage;
Â  Â  return;
Â  }
Â  audio.currentTime = 0;
Â  audio.play().then(() => {
Â  Â  setTimeout(() => {
Â  Â  Â  location.href = nextPage;
Â  Â  }, 400);
Â  }).catch(() => {
Â  Â  location.href = nextPage;
Â  });
}

document.getElementById("start").addEventListener("click", startTest);
document.getElementById("start").addEventListener("touchstart", (e) => {
Â  e.preventDefault();
Â  startTest();
}, { passive: false });

// ì´ ë‘ ë¶€ë¶„ë§Œ ìˆ˜ì •í•˜ë©´ ë¼!
document.body.addEventListener("click", (e) => {
Â  Â  if (e.target.closest('#nav') === null) {
Â  Â  Â  Â  showNextColor();
Â  Â  }
});

document.body.addEventListener("touchstart", (e) => {
Â  Â  if (e.target.closest('#nav') === null) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  showNextColor();
Â  Â  }
}, { passive: false });

document.addEventListener('keydown', (event) => {
Â  if (event.key === 'Escape') {
Â  Â  if (testStarted) {
Â  Â  Â  endTest();
Â  Â  }
Â  }
});

document.addEventListener('fullscreenchange', () => {
Â  if (!document.fullscreenElement && testStarted) {
Â  Â  endTest();
Â  }
});
</script>

</body>
</html>

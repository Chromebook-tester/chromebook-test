<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>LCDãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ</title>
<link rel="stylesheet" href="common-layout.css">
<style>
/* ì´ í˜ì´ì§€ì—ë§Œ ì ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼ */
body {
font-family: sans-serif;
background-color: white; /* í…ŒìŠ¤íŠ¸ ì¤‘ ìƒ‰ìƒ ë³€ê²½ë˜ë¯€ë¡œ ì´ˆê¸°ê°’ì€ í°ìƒ‰ìœ¼ë¡œ ìœ ì§€ */
cursor: default;
overflow: hidden; /* ì „ì²´ í™”ë©´ ì „í™˜ ì‹œ ìŠ¤í¬ë¡¤ ë°©ì§€ìš©ìœ¼ë¡œ ìœ ì§€ */

/* !!! ìƒˆë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•œ ë¶€ë¶„ !!! */
margin: 0 !important; /* common-layout.cssì˜ ë§ˆì§„/íŒ¨ë”©ì„ ë®ì–´ì”€ */
padding: 0 !important; /* common-layout.cssì˜ ë§ˆì§„/íŒ¨ë”©ì„ ë®ì–´ì”€ */
height: 100vh !important; /* ë·°í¬íŠ¸ ë†’ì´ 100%ë¡œ ê°•ì œ */
width: 100vw !important; /* ë·°í¬íŠ¸ ë„ˆë¹„ 100%ë¡œ ê°•ì œ */
position: relative; /* ìì‹ ìš”ì†Œë“¤ì˜ absolute ê¸°ì¤€ì´ ë  ìˆ˜ ìˆë„ë¡ */
}

/* common-layout.cssì˜ h1, nav-buttons ë“± fixed ìš”ì†Œë“¤ì´
   ì´ í˜ì´ì§€ì˜ bodyì— ê°€ë ¤ì§€ë„ë¡ z-indexë¥¼ ì¡°ì •í•˜ê±°ë‚˜,
   hidden í´ë˜ìŠ¤ë¥¼ !importantë¡œ ë”ìš± ê°•ë ¥í•˜ê²Œ ì ìš©í•´ì•¼ í•¨. */
.hidden {
display: none !important; /* !importantë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì‹¤í•˜ê²Œ ìˆ¨ê¹€ */
}

/* start-button, instruction-text, end-message ë“±ì€
   bodyê°€ 100vh 100vwê°€ ëœ ìƒíƒœì—ì„œ ì¤‘ì•™ì— ì˜¬ ìˆ˜ ìˆë„ë¡
   position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
   íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ì¥ í™•ì‹¤í•¨.
   ì§€ê¸ˆì€ ê¸°ì¡´ ë§ˆì§„ì„ ìœ ì§€í•˜ê³ , í•„ìš”í•˜ë©´ ì¡°ì •. */
.start-button {
display: block;
margin: 100px auto 30px auto; /* ì´ˆê¸° ìœ„ì¹˜ ì¡°ì • */
width: 250px;
height: auto;
cursor: pointer;
z-index: 5;
}

p.instruction-text {
font-size: 18px;
margin-top: 0px;
margin-bottom: 30px;
text-align: center;
max-width: 80%;
margin-left: auto;
margin-right: auto;
}

audio {
display: none;
}

.end-message {
position: fixed; /* bodyê°€ 100vh 100vwì´ë¯€ë¡œ fixed/absolute ëª¨ë‘ ê°€ëŠ¥. fixed ìœ ì§€. */
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(0, 0, 0, 0.8);
color: white;
font-size: 28px;
padding: 30px 50px;
border-radius: 10px;
text-align: center;
line-height: 1.5;
display: none;
z-index: 99999;
}
.end-message span {
display: block;
}
</style>
</head>
<body>

<h1><a href="../index.html" class="title-link">LCDãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ</a></h1>

<img id="start" class="start-button" src="../media/images/whitespot-button.png" alt="ã‚¹ã‚¿ãƒ¼ãƒˆ">
<p class="instruction-text">ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è‰²ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚ğŸ¤—</p>

<div id="endMessage" class="end-message">
<span>ãƒ†ã‚¹ãƒˆçµ‚äº†ã€‚</span>
<span>ESCã‚­ãƒ¼ã‚’æŠ¼ã—ã¦çµ‚äº†ã—ã¦ãã ã•ã„ã€‚</span>
</div>

<div id="nav" class="nav-buttons">
<button onclick="playAndNavigate('sound-previous', 'speaker-test.html')">â¬… å‰ã®ãƒ†ã‚¹ãƒˆ</button>
<button onclick="playAndNavigate('sound-home', '../index.html')">ğŸ  ãƒ›ãƒ¼ãƒ </button>
<button onclick="playAndNavigate('sound-next', 'youtube-test.html')">æ¬¡ã®ãƒ†ã‚¹ãƒˆ â¡</button>
</div>

<audio id="sound-previous" src="../media/audio/previous-button-sound.mp3"></audio>
<audio id="sound-home" src="../media/audio/home-button-sound.mp3"></audio>
<audio id="sound-next" src="../media/audio/next-button-sound.mp3"></audio>

<script>
const colors = ['red', 'green', 'white', 'blue', 'black'];
let currentIndex = -1;
let testStarted = false;
const endMessageEl = document.getElementById("endMessage");

function startTest() {
// ëª¨ë“  ì´ˆê¸° UI ìš”ì†Œë“¤ì„ ìˆ¨ê¹€
document.getElementById("start").classList.add("hidden");
document.querySelector('h1').classList.add("hidden"); // h1 íƒœê·¸ ìˆ¨ê¹€
document.querySelector('p.instruction-text').classList.add("hidden"); // p íƒœê·¸ ìˆ¨ê¹€
document.getElementById("nav").classList.add("hidden");

testStarted = true;
currentIndex = -1; // showNextColor í˜¸ì¶œ ì‹œ ì²« ë²ˆì§¸ ìƒ‰ìƒ(red)ë¶€í„° ì‹œì‘ë˜ë„ë¡

// ì „ì²´ í™”ë©´ ëª¨ë“œ ì§„ì… ì‹œë„ (body ìš”ì†Œë¥¼ ì „ì²´ í™”ë©´ìœ¼ë¡œ ë§Œë“¦)
if (document.body.requestFullscreen) {
document.body.requestFullscreen().then(() => {
document.body.style.cursor = "none"; // ì „ì²´ í™”ë©´ ì§„ì… ì‹œ ì»¤ì„œ ìˆ¨ê¹€
showNextColor(); // ì²« ìƒ‰ìƒ(red) í‘œì‹œ
}).catch(err => {
// ì „ì²´ í™”ë©´ ì§„ì… ì‹¤íŒ¨ ì‹œ (ì˜ˆ: ì‚¬ìš©ì ì œìŠ¤ì²˜ ë¶€ì¡±, ê¶Œí•œ ì—†ìŒ)
console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
// ì‹¤íŒ¨í•´ë„ í…ŒìŠ¤íŠ¸ëŠ” ì§„í–‰ (ê°•ì œë¡œ ë°°ê²½ìƒ‰ ë³€ê²½)
document.body.style.cursor = "none"; // ì‹¤íŒ¨í•´ë„ ì»¤ì„œ ìˆ¨ê¹€
showNextColor(); // ì²« ìƒ‰ìƒ(red) í‘œì‹œ
});
} else {
// requestFullscreen API ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €
document.body.style.cursor = "none"; // ì»¤ì„œ ìˆ¨ê¹€
showNextColor(); // ì²« ìƒ‰ìƒ(red) í‘œì‹œ
}
}

function endTest() {
testStarted = false; // í…ŒìŠ¤íŠ¸ ìƒíƒœ ì¢…ë£Œ
currentIndex = -1; // ì¸ë±ìŠ¤ ì´ˆê¸°í™”

// í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ë©”ì‹œì§€ í‘œì‹œ
endMessageEl.style.display = 'flex'; // flexë¡œ ì„¤ì •í•˜ì—¬ ì¤‘ì•™ ì •ë ¬ ë˜ë„ë¡

// ì „ì²´ í™”ë©´ ëª¨ë“œ í•´ì œ ì‹œë„
if (document.fullscreenElement) { // í˜„ì¬ ë¬¸ì„œê°€ ì „ì²´ í™”ë©´ ëª¨ë“œì¼ ë•Œë§Œ í•´ì œ ì‹œë„
document.exitFullscreen().then(() => {
// ì „ì²´ í™”ë©´ í•´ì œ ì„±ê³µ í›„ ì´ˆê¸° í™”ë©´ ìš”ì†Œ í‘œì‹œ
restoreInitialUI();
}).catch(err => {
// ì „ì²´ í™”ë©´ í•´ì œ ì‹¤íŒ¨ ì‹œ (ì—ëŸ¬ ë°œìƒí•´ë„ UIëŠ” ë³µêµ¬)
console.error("Fullscreen exit failed:", err);
restoreInitialUI();
});
} else {
// ì „ì²´ í™”ë©´ ëª¨ë“œê°€ ì•„ë‹ˆë©´ ë°”ë¡œ ì´ˆê¸° í™”ë©´ ìš”ì†Œ í‘œì‹œ
restoreInitialUI();
}
}

// ì´ˆê¸° UI ìƒíƒœë¡œ ë³µêµ¬í•˜ëŠ” í•¨ìˆ˜
function restoreInitialUI() {
document.getElementById("start").classList.remove("hidden");
document.querySelector('h1').classList.remove("hidden");
document.querySelector('p.instruction-text').classList.remove("hidden"); // p íƒœê·¸ ë‹¤ì‹œ ë³´ì´ê²Œ
document.getElementById("nav").classList.remove("hidden");
document.body.style.backgroundColor = "white"; // ë°°ê²½ìƒ‰ ì›ë˜ëŒ€ë¡œ (í°ìƒ‰)
document.body.style.cursor = "default"; // ì»¤ì„œ ë‹¤ì‹œ ë³´ì´ê²Œ
endMessageEl.style.display = 'none'; // ì¢…ë£Œ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
}

function showNextColor() {
if (!testStarted) return; // í…ŒìŠ¤íŠ¸ ì‹œì‘ ì•ˆ í–ˆìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨

currentIndex++;

if (currentIndex >= colors.length) {
endTest(); // ëª¨ë“  ìƒ‰ìƒì„ ë‹¤ ë´¤ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ë¡œì§ ì‹¤í–‰
} else {
// CSS ìš°ì„ ìˆœìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ !importantë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°ê²½ìƒ‰ ì„¤ì •
document.body.style.setProperty("background-color", colors[currentIndex], "important");
}
}

function playAndNavigate(soundId, nextPage) {
const audio = document.getElementById(soundId);
if (!audio) {
location.href = nextPage;
return;
}

audio.currentTime = 0;
audio.play().then(() => {
setTimeout(() => {
location.href = nextPage;
}, 400);
}).catch(() => {
location.href = nextPage;
});
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.getElementById("start").addEventListener("click", startTest);
document.getElementById("start").addEventListener("touchstart", (e) => {
e.preventDefault();
startTest();
}, { passive: false });

// body í´ë¦­/í„°ì¹˜ ì‹œ ë‹¤ìŒ ìƒ‰ìƒ ë˜ëŠ” í…ŒìŠ¤íŠ¸ ì¢…ë£Œ
document.body.addEventListener("click", showNextColor);
document.body.addEventListener("touchstart", (e) => {
e.preventDefault();
showNextColor();
}, { passive: false });

// ESC í‚¤ë¡œ ì „ì²´ í™”ë©´ í•´ì œ ì‹œ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ
document.addEventListener('keydown', (event) => {
if (event.key === 'Escape') {
if (testStarted) { // í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ endTest í˜¸ì¶œ
endTest();
}
}
});

// ì „ì²´ í™”ë©´ ìƒíƒœ ë³€ê²½ ê°ì§€ (ì˜ˆ: ë¸Œë¼ìš°ì € UIë¡œ ì „ì²´ í™”ë©´ ì¢…ë£Œ ì‹œ)
document.addEventListener('fullscreenchange', () => {
if (!document.fullscreenElement && testStarted) { // ì „ì²´ í™”ë©´ì´ ì¢…ë£Œë˜ì—ˆê³ , í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ ì¤‘ì´ì—ˆë‹¤ë©´
endTest(); // í…ŒìŠ¤íŠ¸ ì¢…ë£Œ í•¨ìˆ˜ í˜¸ì¶œ (ì—¬ê¸°ì„œ UI ë³µêµ¬ë„ ì§„í–‰)
}
});
</script>

</body>
</html>